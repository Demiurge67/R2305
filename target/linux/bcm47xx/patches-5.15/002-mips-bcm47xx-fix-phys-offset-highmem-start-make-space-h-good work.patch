From: Demiurge67 <dem@dem.dem> Fix BCM47XX memory mapping
Subject: [PATCH] mips: bcm47xx: define PHYS_OFFSET and HIGHMEM_START

The bcm47xx platform lacks its own definitions for PHYS_OFFSET and
HIGHMEM_START, relying on generic defaults that are incorrect for its
memory layout (128MB lowmem + 128MB highmem banks). This causes memory
registration errors and prevents highmem from being used.

This commit provides the correct constants for BCM47xx SoCs like BCM4706.

Signed-off-by: Demiurge67 <dem@dem.dem

 arch/mips/include/asm/mach-bcm47xx/spaces.h | 28 ++++++++++++++++++++++++++++
 1 file changed, 28 insertions(+)
 create mode 100644 arch/mips/include/asm/mach-bcm47xx/spaces.h

diff --git a/arch/mips/include/asm/mach-bcm47xx/spaces.h b/arch/mips/include/asm/mach-bcm47xx/spaces.h
new file mode 100644
index 000000000000..3c661b5e50e1
--- /dev/null
+++ b/arch/mips/include/asm/mach-bcm47xx/spaces.h
@@ -0,0 +1,28 @@
+/* SPDX-License-Identifier: GPL-2.0 */
+/*
+ * This file is subject to the terms and conditions of the GNU General Public
+ * License.  See the file "COPYING" in the main directory of this archive
+ * for more details.
+ *
+ * Copyright (C) 2024
+ */
+#ifndef _ASM_MACH_BCM47XX_SPACES_H
+#define _ASM_MACH_BCM47XX_SPACES_H
+
+/*
+ * BCM47xx (e.g., BCM4706) physical memory layout.
+ * The first 128 MiB are directly mapped in KSEG0 at 0x00000000.
+ * The second 128 MiB bank starts at physical 0x87ffffff and requires HIGHMEM.
+ */
+#define PHYS_OFFSET		_AC(0x00000000, UL)
+#define HIGHMEM_START		_AC(0x88000000, UL)
+
+/*
+ * Include generic definitions for other constants (CAC_BASE, PAGE_OFFSET, etc.)
+ * after we have defined our platform-specific overrides.
+ */
+#include <asm/mach-generic/spaces.h>
+
+#endif /* _ASM_MACH_BCM47XX_SPACES_H */
+
+ 

