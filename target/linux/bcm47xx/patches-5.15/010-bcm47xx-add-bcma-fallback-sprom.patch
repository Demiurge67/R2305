From: Your Name <your.email@example.com>
Date: Mon, 1 Jan 2024 12:00:00 +0300
Subject: [PATCH] bcm47xx: add fallback SPROM support for BCMA bus

This patch registers a fallback SPROM provider for BCMA devices that
lack valid SPROM (e.g., the second BCM4331 radio on ASUS RT-N66U).
It is required to enable the 5 GHz band on such devices.

diff --git a/arch/mips/bcm47xx/Makefile b/arch/mips/bcm47xx/Makefile
index xxxxxxx..xxxxxxx 100644
--- a/arch/mips/bcm47xx/Makefile
+++ b/arch/mips/bcm47xx/Makefile
@@ -1,4 +1,5 @@
 # SPDX-License-Identifier: GPL-2.0
 obj-y				+= gpio.o nvram.o prom.o setup.o time.o
+obj-y				+= sprom.o
 obj-$(CONFIG_BCM47XX_SSB)	+= sprom_ssb.o
 obj-$(CONFIG_EARLY_PRINTK)	+= early_printk.o
diff --git a/arch/mips/bcm47xx/setup.c b/arch/mips/bcm47xx/setup.c
index xxxxxxx..xxxxxxx 100644
--- a/arch/mips/bcm47xx/setup.c
+++ b/arch/mips/bcm47xx/setup.c
@@ -XX,6 +XX,7 @@
 #include <asm/time.h>
 #include <bcm47xx.h>
 #include <bcm47xx_nvram.h>
+#include <asm/mach-bcm47xx/bcm47xx_fallback_sprom.h>
 
 static char nvram_buf[NVRAM_SPACE] __initdata;
 
@@ -XXX,6 +XXX,9 @@ void __init bcm47xx_register_bus(void)
 		break;
 	}
 
+	/* Register fallback SPROM for BCMA devices without valid SPROM */
+	bcm47xx_register_fallback_sprom();
+
 	err = bcma_bus_register(bus);
 	if (err)
 		panic("Failed to register BCMA bus: %d\n", err);
